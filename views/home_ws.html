<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Filtered HN</title>

    <link href="css/bootstrap-5.3.0-alpha1-min.css" rel="stylesheet">
    <link href="css/fontawesome-free-all-6.3.0-min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <script src="js/jquery-3.6.0-min.js"></script>
    <script src="js/bootstrap-5.3.0-alpha1-min.js"></script>
    <script src="js/underscore-1.13.1-min.js"></script>
    <script src="js/purl.js"></script>
    <script src="js/uuid-8.3.2-min.js"></script>
    <script src="js/scripts.js"></script>

    </script>
  </head>

  <body rbgcolor="#202020">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg sticky-top" data-bs-theme="light" style="background-color: #f60;">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <img src="/img/y18.gif" style="border:1px white solid;" width="25" heigth="25"/>
          Filtered HN
      </a>
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item px-3 accordion-item">
            <h1 class="accordion-header" id="headerGood">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGood" aria-expanded="true" aria-controls="collapseGood">
            Good&nbsp;<span class="badge text-bg-warning" id="good-len">0</span>
            </button>
            </h1>
          </li>
          <li class="nav-item px-3">
            <h1 class="accordion-header" id="headerCrap">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCrap" aria-expanded="false" aria-controls="collapseCrap">
            Crap&nbsp;<span class="badge text-bg-warning" id="crap-len">0</span>
            </button>
            </h1>
          </li>
        </ul>
      <div class="d-flex justify-content-end">
        <form class="container-fluid">
          <button id="edit-btn" class="btn btn-danger me-2" type="button">Edit filter</button>
        </form>
      </div>
      <div class="d-flex justify-content-end">
        <form class="container-fluid">
          <button id="reload-btn" class="btn btn-danger me-2" type="button">Refresh</button>
        </form>
      </div>
    </div>
  </nav>


  <!-- Progress Modal -->
  <div class="modal fade" id="progressModal" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Loading Data...</h4>
        </div>
        <div class="modal-body">
            <div id="progress" class="progress" role="progressbar">
                <div class="progress-bar bg-danger" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Editor Modal -->
  <div class="modal fade" id="filterModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-xl" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit filter.txt</h5>
        </div>
        <div class="modal-body">
          <p>You are adding filter for this url: <span id="help-filter-text"></span></p>
          <p>Lines starting with ">" define sections of similar crap</p>
          <textarea id="filter-text" class="form-control col-md-8" rows="25"></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="saveCrap()">Remove that crap!</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Save Toast -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="saveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <img src="..." class="rounded me-2" alt="...">
        <strong class="me-auto">HN Filter</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        New filter was saved
      </div>
    </div>
  </div>

    <script id="progress-template" type="text/template">
        <% var percentComplete = parseInt(progress) / 3 * 100; %>
        <% var formatted = (percentComplete / 100).toLocaleString(undefined, {style: 'percent', minimumFractionDigits: 0}) %>
        <% if (percentComplete > 0) { %>
            <div class="progress-bar bg-danger" style="width: <%= percentComplete %>%;" aria-valuenow="<%= percentComplete %>" aria-valuemin="0" aria-valuemax="100"><%= formatted %></div>
        <% } %>
    </script>

    <div class="accordion" id="data">
      <div class="accordion-item">
        <div class="col-md-9 mx-auto accordion-collapse collapse show" id="collapseGood" aria-labelledby="headerGood" data-bs-parent="#data">
          <div class="accordion-body">
            <table class="table table-striped table-hover table-sm sortableGood" id="good-table">
            <thead>
              <tr>
                <th>Comments</th>
                <th>Rank</th>
                <th>Link</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <div class="col-md-9 mx-auto accordion-collapse collapse" id="collapseCrap" aria-labelledby="headerCrap" data-bs-parent="#data">
          <div class="accordion-body">
            <table class="table table-striped table-hover table-sm sortableCrap" id="crap-table">
            <thead>
              <tr>
                <th>Comments</th>
                <th>Rank</th>
                <th>Link</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script id="info-template" type="text/template">
        <%= info %>
    </script>

    <script id="good-data-template" type="text/template">
                <% _.each(stories, function(story) { %>
                <tr>
                <td><a href="<%= story.comments_link %>" target="_blank"><%= story.comments_num %></a></td>
                <td><span class="score hot" title="Points"><%= story.points %></span></td>
                <td class="title">
                    <a href="<%= story.link %>" class="storylink" target="_blank"><%= story.title %></a>
                    <span>
                        (<%= story.host %>)<i id="post-link" onclick="addToCrap('<%= story.host %>')" class="fa-solid fa-thumbs-down ps-2 crapicon"></i>
                    </span>
                </td>
                <td>
                <% }); %>
    </script>

    <script id="crap-data-template" type="text/template">
                <% _.each(stories, function(story, index) { %>
                <tr class="crap">
                <td class="crap"><a href="<%= story.comments_link %>" target="_blank"><%= story.comments_num %></a></td>
                <td class="crap"><span class="score hot" title="Points"><%= story.points %></span></td>
                <td  class="crap">
                    <a href="<%= story.link %>" class="storylink" target="_blank"><%= story.title %></a>
                    <span class="sitebit comhead">
                        <span class="paren">(</span><span><%= story.host %></span><span class="paren">)</span>
                    </span>
                    <span class="sitebit comhead">
                        <span class="paren">(</span><span id="crap<%= index %>" onclick="showWhy(<%= index %>)">Why?</span><span class="paren">)</span>
                    </span>
                </td>
                </tr>
                <% }); %>
    </script>


      <script>
        $(document).ready(function() {
            reload();
            setupTableSort("good-table");
            setupTableSort("crap-table");
        });
    </script>
  </body>
</html>
